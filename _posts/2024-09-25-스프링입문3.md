---
title : 스프링 빈과 의존관계 및 DB 접근
date: 2024-09-24 +1400
categories: [Spring]
tags: [dependency-injection, bean, mvc, db]
---

## 스프링 빈을 등록하는 방법
1. 컴포넌트 스캔과 자동 의존관계 설정
2. 자바 코드로 직접 스프링 빈 등록하기

## 컴포넌트 스캔과 자동 의존관계 설정
- ```@Component``` 애노테이션이 있으면 스프링 빈으로 자동 등록됨
  - ```@Controller, @Service, @Repository``` 는 ```@Component``` 를 포함함
- ```@Controller``` 컨트롤러가 스프링빈으로 자동 등록된 이유도 컴포넌트 스캔 때문

> 참고: 생성자에 ```@Autowired``` 를 사용하면 객체 생성 시점에 스프링 컨테이너에서 해당 스프링 빈을 찾아서 주입한다. (생성자가 1개만 있으면 ```@Autowired``` 는 생략할 수 있다.)

스프링은 스프링 컨테이너에 스프링 빈을 등록할 때, 기본으로 **싱글톤**으로 등록한다 (유일하게 하나만 등록해서 공유). 따라서 같은 스프링 빈이면 모두 같은 인스턴스다. 

## 의존성 주입
1. 필드 주입
2. Setter 주입
3. 생성자 주입

의존관계가 실행중에 동적으로 변하는 경우는 거의 없으므로 생성자 주입을 권장한다!

> 주로 정형화된 컨트롤러, 서비스, 리포지토리는 컴포넌트 스캔을 사용하고, 정형화 되지 않거나, 상황에 따라 구현 클래스를 변경해야 하면 설정을 통해 스프링 빈으로 등록한다.

컨트롤러가 정적 파일보다 우선순위가 높다. 

## OCP(Open-Closed Principle)
- 확장에는 열려있고, 수정, 변경에는 닫혀있다. 
- 스프링의 DI 를 사용하면 **기존 코드를 전혀 손대지 않고, 설정만으로 구현 클래스를 변경 할 수 있다.**


## 스프링 통합 테스트
- ```@SpringBootTest``` 스프링 컨테이너와 테스트를 함께 실행한다.
- ```@Transactional``` 테스트 케이스에 이 애노테이션이 있으면, 테스트 시작 전에 트랜잭션을 시작하고, 테스트 완료 후에 항상 롤백한다.
  - 이렇게 하면 DB에 데이터가 남지 않으므로 다음 테스트에 영향을 주지 않는다. 